# GitHub Actions ì›Œí¬í”Œë¡œìš° - Chapter 04-01 ì‹¤ì‹œê°„ ê²€ìƒ‰ ë°°í¬
name: Deploy Chapter 04-01 Realtime Search

# íŠ¸ë¦¬ê±° ì¡°ê±´: main ë¸Œëœì¹˜ì˜ íŠ¹ì • ê²½ë¡œì— pushë  ë•Œë§Œ ì‹¤í–‰
on:
  push:
    branches: [ main ]
    paths: 
      - 'chapter04/04-01-realtime-search-ts/**'
      - '.github/workflows/deploy-chapter04-01.yml'
  
  # ìˆ˜ë™ ì‹¤í–‰ì„ ìœ„í•œ ì˜µì…˜
  workflow_dispatch:

# ê¶Œí•œ ì„¤ì • (GitHub Pages ë°°í¬ë¥¼ ìœ„í•´ í•„ìš”)
permissions:
  contents: read
  pages: write
  id-token: write

# ë™ì‹œ ì‹¤í–‰ ë°©ì§€ (ê°™ì€ ì›Œí¬í”Œë¡œìš°ê°€ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë°©ì§€)
concurrency:
  group: "pages-chapter04-01"
  cancel-in-progress: false

jobs:
  # ë¹Œë“œ ì‘ì—…
  build:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        
      # 2. Node.js ì„¤ì •
      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: chapter04/04-01-realtime-search-ts/package-lock.json
          
      # 3. ì˜ì¡´ì„± ì„¤ì¹˜
      - name: ğŸ“¦ Install dependencies
        working-directory: ./chapter04/04-01-realtime-search-ts
        run: |
          npm ci
          
      # 4. TypeScript íƒ€ì… ì²´í¬
      - name: ğŸ” Type check
        working-directory: ./chapter04/04-01-realtime-search-ts
        run: |
          npm run build
          
      # 5. ESLint ê²€ì‚¬
      - name: ğŸ§¹ Lint check
        working-directory: ./chapter04/04-01-realtime-search-ts
        run: |
          npm run lint
          
      # 6. í”„ë¡œë•ì…˜ ë¹Œë“œ
      - name: ğŸ—ï¸ Build for production
        working-directory: ./chapter04/04-01-realtime-search-ts
        run: |
          npm run build
          
      # 7. ë¹Œë“œ ê²°ê³¼ í™•ì¸
      - name: ğŸ“‹ List build output
        working-directory: ./chapter04/04-01-realtime-search-ts
        run: |
          echo "Build completed. Contents of dist folder:"
          ls -la dist/
          
      # 8. GitHub Pages ì„¤ì •
      - name: ğŸ”§ Setup Pages
        uses: actions/configure-pages@v4
        
      # 9. ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ (ë¹Œë“œëœ íŒŒì¼ë“¤ì„ ì„ì‹œ ì €ì¥)
      - name: ğŸ“¤ Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./chapter04/04-01-realtime-search-ts/dist

  # ë°°í¬ ì‘ì—… (ë¹Œë“œê°€ ì„±ê³µí•œ í›„ ì‹¤í–‰)
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    
    steps:
      # 10. GitHub Pagesì— ë°°í¬
      - name: ğŸš€ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        
      # 11. ë°°í¬ ì™„ë£Œ ì•Œë¦¼
      - name: ğŸ‰ Deployment completed
        run: |
          echo "ğŸ‰ ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
          echo "ğŸŒ ì‚¬ì´íŠ¸ URL: ${{ steps.deployment.outputs.page_url }}"
